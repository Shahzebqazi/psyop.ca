<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSYOP - Electronic Music</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Three.js for WebGL physics -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

<!-- Dynamic background system -->
<div class="dynamic-background" id="dynamic-background">
    <!-- Transition overlay for smooth image changes -->
    <div class="transition-overlay" id="transition-overlay"></div>
    <!-- White images for vertical screens -->
    <img src="/assets/white/promo_1.jpg" class="background-image" data-index="0" alt="Background 1">
    <img src="/assets/white/promo_2.jpg" class="background-image" data-index="1" alt="Background 2">
    <img src="/assets/white/promo_3.jpg" class="background-image" data-index="2" alt="Background 3">
    <img src="/assets/white/promo_4.jpg" class="background-image" data-index="3" alt="Background 4">
    <img src="/assets/white/promo_5.jpg" class="background-image" data-index="4" alt="Background 5">
    <img src="/assets/white/promo_6.jpg" class="background-image" data-index="5" alt="Background 6">
    <img src="/assets/white/promo_7.jpg" class="background-image" data-index="6" alt="Background 7">
    <img src="/assets/white/promo_8.jpg" class="background-image" data-index="7" alt="Background 8">
    <img src="/assets/white/promo_9.jpg" class="background-image" data-index="8" alt="Background 9">
    <img src="/assets/white/promo_10.jpg" class="background-image" data-index="9" alt="Background 10">
    <img src="/assets/white/promo_11.jpg" class="background-image" data-index="10" alt="Background 11">
    <img src="/assets/white/promo_12.jpg" class="background-image" data-index="11" alt="Background 12">
    
    <!-- Red images for wide screens -->
    <img src="/assets/red_white/promo_1.jpg" class="background-image red-image" data-index="0" alt="Red Background 1">
    <img src="/assets/red_white/promo_2.jpg" class="background-image red-image" data-index="1" alt="Red Background 2">
    <img src="/assets/red_white/promo_3.jpg" class="background-image red-image" data-index="2" alt="Red Background 3">
    <img src="/assets/red_white/promo_4.jpg" class="background-image red-image" data-index="3" alt="Red Background 4">
    <img src="/assets/red_white/promo_5.jpg" class="background-image red-image" data-index="4" alt="Red Background 5">
    <img src="/assets/red_white/promo_6.jpg" class="background-image red-image" data-index="5" alt="Red Background 6">
    <img src="/assets/red_white/promo_1.jpg" class="background-image red-image" data-index="6" alt="Red Background 7">
    <img src="/assets/red_white/promo_2.jpg" class="background-image red-image" data-index="7" alt="Red Background 8">
    <img src="/assets/red_white/promo_3.jpg" class="background-image red-image" data-index="8" alt="Red Background 9">
    <img src="/assets/red_white/promo_4.jpg" class="background-image red-image" data-index="9" alt="Red Background 10">
    <img src="/assets/red_white/promo_5.jpg" class="background-image red-image" data-index="10" alt="Red Background 11">
    <img src="/assets/red_white/promo_6.jpg" class="background-image red-image" data-index="11" alt="Red Background 12">
</div>

<!-- The menu, placed on top of the animated background -->
<header id="main-menu">
  <nav>
    <ul>
      <li><a href="#home" class="menu-link active">Home</a></li>
      <li><a href="#music" class="menu-link">Music</a></li>
      <li><a href="#links" class="menu-link">Links</a></li>
      <li><a href="#shows" class="menu-link">Upcoming Shows</a></li>
    </ul>
  </nav>
</header>

<!-- Main content for scrolling -->
<main>
  <section id="home" class="page">
    <div class="page-content">
      <!-- Polaroid String Gallery - Hung Side by Side -->
      <div class="polaroid-string-gallery">
        <!-- String line with Halloween decorations -->
        <div class="string-line">
          <!-- Spider web on the left -->
          <div class="spider-web left-web"></div>
          
          <!-- Pumpkin decoration -->
          <div class="pumpkin-decoration"></div>
          
          <!-- Bat decoration -->
          <div class="bat-decoration"></div>
          
          <!-- Spider web on the right -->
          <div class="spider-web right-web"></div>
        </div>
        
        <!-- Polaroids hung on the string -->
        <div class="polaroid-row">
          <!-- psyop 01 Moonlight Paradox -->
          <div class="polaroid-container" id="polaroid1">
            <div class="string-clip"></div>
            <div class="polaroid-image">
              <div class="polaroid-caption">psyop 01 Moonlight Paradox /ln April 2025</div>
              <img 
                src="/assets/white/promo_5.jpg" 
                alt="PSYOP 01 Moonlight Paradox" 
                loading="lazy"
                decoding="async"
                onload="this.style.opacity='1'"
                style="opacity: 0; transition: opacity 0.5s ease-in-out;">
            </div>
          </div>
          
          <!-- psyop 02 Great in Vain -->
          <div class="polaroid-container" id="polaroid2">
            <div class="string-clip"></div>
            <div class="polaroid-image">
              <div class="polaroid-caption">psyop 02 Great in Vain /ln August 2025</div>
              <img 
                src="/assets/white/promo_1.jpg" 
                alt="PSYOP 02 Great in Vain" 
                loading="lazy"
                decoding="async"
                onload="this.style.opacity='1'"
                style="opacity: 0; transition: opacity 0.5s ease-in-out;">
            </div>
          </div>
          
          <!-- @psyopband -->
          <div class="polaroid-container" id="polaroid3" onclick="window.open('https://instagram.com/psyopband', '_blank')">
            <div class="string-clip"></div>
            <div class="polaroid-image clickable">
              <div class="polaroid-caption">@psyopband</div>
              <img 
                src="/assets/white/promo_2.jpg" 
                alt="PSYOP Band Photo" 
                loading="lazy"
                decoding="async"
                onload="this.style.opacity='1'"
                style="opacity: 0; transition: opacity 0.5s ease-in-out;">
            </div>
          </div>
        </div>
      </div>
      
      <div class="scroll-indicator">
        <div class="scroll-text">Scroll Down</div>
        <div class="scroll-arrow">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
    </div>
  </section>
  
  <section id="music" class="page">
    <div class="page-content">
      <h2>Music</h2>
      <div class="music-tracks">
        <!-- psyop 01 Moonlight Paradox -->
        <div class="track-item">
          <div class="track-artwork">
            <img 
              src="/assets/white/promo_5.jpg" 
              alt="psyop 01 Moonlight Paradox" 
              loading="lazy"
              decoding="async"
              onload="this.style.opacity='1'"
              style="opacity: 0; transition: opacity 0.5s ease-in-out;">
          </div>
          <div class="track-info">
            <h3>psyop 01 Moonlight Paradox</h3>
            <p class="track-status">April 2025</p>
            <a href="https://distrokid.com/hyperfollow/psyop21/moonlight-paradox" 
               target="_blank" 
               rel="noopener noreferrer" 
               class="track-link">
              Listen Now
            </a>
          </div>
        </div>
        
        <!-- psyop 02 Great in Vain -->
        <div class="track-item">
          <div class="track-artwork">
            <img 
              src="/assets/white/promo_1.jpg" 
              alt="psyop 02 Great in Vain" 
              loading="lazy"
              decoding="async"
              onload="this.style.opacity='1'"
              style="opacity: 0; transition: opacity 0.5s ease-in-out;">
          </div>
          <div class="track-info">
            <h3>psyop 02 Great in Vain</h3>
            <p class="track-status">August 2025</p>
            <a href="#" class="track-link disabled">
              Coming Soon
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <section id="links" class="page">
    <div class="page-content">
    </div>
  </section>
  
  <section id="shows" class="page">
    <div class="page-content">
    </div>
  </section>
</main>

<script>
    // Dynamic background system
    class DynamicBackground {
        constructor() {
            this.backgroundContainer = document.getElementById('dynamic-background');
            this.backgroundImages = document.querySelectorAll('.background-image');
            this.currentImageIndex = 0;
            this.isWideScreen = window.innerWidth > window.innerHeight;
            this.recentImages = []; // Track recently used images
            this.minRepeatDistance = 6; // Minimum images before repetition
            this.usedCount = 0; // Simple counter instead of array length
            this.scrollTimeout = null; // For scroll idle detection
            this.init();
        }

        init() {
            // Show first image
            this.showImage(0);
            
            // Log available images for debugging
            const whiteImages = document.querySelectorAll('.background-image:not(.red-image)');
            const redImages = document.querySelectorAll('.red-image');
            console.log(`Available images - White: ${whiteImages.length}, Red: ${redImages.length}`);
            
            // Add event listeners
            window.addEventListener('scroll', this.handleScroll.bind(this));
            window.addEventListener('resize', this.handleResize.bind(this));
            
            // Initialize manual menu highlighting
            this.initManualMenuHighlighting();
            
            // Initialize background state (start with scrolling state)
            this.backgroundContainer.classList.add('scrolling');
        }

        handleScroll() {
            const scrollPosition = window.scrollY;
            const windowHeight = window.innerHeight;
            const documentHeight = document.body.scrollHeight;
            
            // Calculate scroll progress as a percentage (0 to 1)
            const scrollProgress = scrollPosition / (documentHeight - windowHeight);
            
            // Update background image based on scroll progress (every half page)
            this.updateBackgroundImageByScroll(scrollProgress);
            
            // Update menu highlighting based on scroll position
            this.updateMenuHighlighting(scrollPosition);
            
            // Handle scroll idle detection for background blur effect
            this.handleScrollIdle();
            
            // Animate Polaroid based on scroll
            this.animatePolaroid(scrollPosition);
        }

        updateBackgroundImage(sectionIndex) {
            // Determine which image set to use based on screen orientation
            const images = this.isWideScreen ? 
                document.querySelectorAll('.red-image') : 
                document.querySelectorAll('.background-image:not(.red-image)');
            
            if (images.length === 0) {
                console.warn('No images found for current screen orientation');
                return;
            }
            
            // Calculate image index based on section
            const imageIndex = sectionIndex % images.length;
            
            if (imageIndex !== this.currentImageIndex) {
                this.showImage(imageIndex);
                this.currentImageIndex = imageIndex;
            }
        }

        updateBackgroundImageByScroll(scrollProgress) {
            // Determine which image set to use based on screen orientation
            const images = this.isWideScreen ? 
                document.querySelectorAll('.red-image') : 
                document.querySelectorAll('.background-image:not(.red-image)');
            
            if (images.length === 0) {
                console.warn('No images found for current screen orientation');
                return;
            }
            
            // Calculate base image index based on scroll progress
            const baseImageIndex = Math.floor(scrollProgress * images.length);
            
            // Find an image that hasn't been used recently
            const smartIndex = this.findNonRepeatingImage(baseImageIndex, images.length);
            
            if (smartIndex !== this.currentImageIndex) {
                console.log(`Scroll: ${scrollProgress.toFixed(3)}, Smart Image: ${smartIndex + 1}/${images.length}`);
                this.showImage(smartIndex);
                this.currentImageIndex = smartIndex;
            }
        }

        showImage(index) {
            // Get the appropriate image set
            const images = this.isWideScreen ? 
                document.querySelectorAll('.red-image') : 
                document.querySelectorAll('.background-image:not(.red-image)');
            
            if (images.length === 0) {
                console.warn(`No images found for ${this.isWideScreen ? 'wide' : 'vertical'} screen orientation`);
                return;
            }
            
            // Ensure index is within bounds
            const clampedIndex = Math.min(Math.max(index, 0), images.length - 1);
            
            // Show transition overlay
            const transitionOverlay = document.getElementById('transition-overlay');
            if (transitionOverlay) {
                transitionOverlay.classList.add('active');
            } else {
                console.warn('Transition overlay element not found');
            }
            
            // Hide all images first
            this.backgroundImages.forEach(img => img.classList.remove('active'));
            
            // Show the target image after a short delay
            setTimeout(() => {
                if (images[clampedIndex]) {
                    images[clampedIndex].classList.add('active');
                    this.usedCount++;
                } else {
                    console.error(`Image at index ${clampedIndex} not found`);
                }
                
                // Hide transition overlay after image is visible
                setTimeout(() => {
                    if (transitionOverlay) {
                        transitionOverlay.classList.remove('active');
                    }
                }, 600);
                
                // Update current index
                this.currentImageIndex = clampedIndex;
            }, 300);
        }

        findNonRepeatingImage(baseIndex, totalImages) {
            // Special transition logic: alternate between promo_9.jpg (index 8) and promo_12.jpg (index 11)
            const promo9Index = 8;  // promo_9.jpg
            const promo12Index = 11; // promo_12.jpg
            
            // If we're currently showing promo_9, switch to promo_12, and vice versa
            if (this.currentImageIndex === promo9Index) {
                return promo12Index;
            } else if (this.currentImageIndex === promo12Index) {
                return promo9Index;
            } else {
                // For other images, use the original non-repeating logic
                let candidateIndex = baseIndex;
                
                // Check if this image has been used recently
                for (let attempts = 0; attempts < totalImages; attempts++) {
                    // Ensure index is within bounds
                    candidateIndex = (baseIndex + attempts) % totalImages;
                    
                    // Check if this image hasn't been used in the last minRepeatDistance images
                    if (!this.recentImages.includes(candidateIndex)) {
                        // Add to recent images and remove oldest if we exceed the limit
                        this.recentImages.push(candidateIndex);
                        if (this.recentImages.length > this.minRepeatDistance) {
                            this.recentImages.shift();
                        }
                        return candidateIndex;
                    }
                }
                
                // If all images have been used recently, reset and use base index
                this.recentImages = [];
                this.recentImages.push(baseIndex);
                return baseIndex;
            }
        }

        handleResize() {
            const wasWideScreen = this.isWideScreen;
            this.isWideScreen = window.innerWidth > window.innerHeight;
            
            // If orientation changed, update image display
            if (wasWideScreen !== this.isWideScreen) {
                console.log(`Screen orientation changed to ${this.isWideScreen ? 'wide' : 'vertical'}`);
                this.showImage(this.currentImageIndex);
            }
        }

        handleScrollIdle() {
            // Clear existing timeout
            if (this.scrollTimeout) {
                clearTimeout(this.scrollTimeout);
            }
            
            // Remove idle class (show scrolling state)
            this.backgroundContainer.classList.remove('idle');
            this.backgroundContainer.classList.add('scrolling');
            
            // Set timeout to add idle class after scrolling stops
            this.scrollTimeout = setTimeout(() => {
                this.backgroundContainer.classList.remove('scrolling');
                this.backgroundContainer.classList.add('idle');
            }, 1000); // 1 second delay before applying blur
        }
        
        updateMenuHighlighting(scrollPosition) {
            const sections = ['home', 'music', 'links', 'shows'];
            const menuLinks = document.querySelectorAll('.menu-link');
            const windowHeight = window.innerHeight;
            
            // Find which section is currently in view
            let currentSection = 'home';
            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                if (section) {
                    const rect = section.getBoundingClientRect();
                    if (rect.top <= windowHeight * 0.5 && rect.bottom >= windowHeight * 0.5) {
                        currentSection = sectionId;
                    }
                }
            });
            
            // Update menu highlighting
            menuLinks.forEach(link => {
                const href = link.getAttribute('href').substring(1);
                if (href === currentSection) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }
        
        animatePolaroid(scrollPosition) {
            const polaroids = ['polaroid1', 'polaroid2', 'polaroid3'];
            
            polaroids.forEach((id, index) => {
                const polaroid = document.getElementById(id);
                if (!polaroid) return;
                
                const windowHeight = window.innerHeight;
                const polaroidRect = polaroid.getBoundingClientRect();
                const polaroidCenter = polaroidRect.top + polaroidRect.height / 2;
                const viewportCenter = windowHeight / 2;
                
                // Calculate distance from viewport center
                const distanceFromCenter = polaroidCenter - viewportCenter;
                const maxDistance = windowHeight / 2;
                const scrollProgress = Math.abs(distanceFromCenter) / maxDistance;
                
                // Apply parallax effect with different offsets for each Polaroid
                const offsetMultipliers = [0.2, 0.3, 0.4]; // Reduced parallax for string layout
                const offsetMultiplier = offsetMultipliers[index] || 0.3;
                const parallaxOffset = distanceFromCenter * offsetMultiplier;
                const rotation = -1 + (scrollProgress * 2); // Reduced rotation for string layout
                const scale = 1 - (scrollProgress * 0.05); // Reduced scale effect
                
                polaroid.style.transform = `
                    translateY(${parallaxOffset}px) 
                    rotate(${rotation}deg) 
                    scale(${scale})
                    translateZ(${scrollProgress * 10}px)
                `;
                
                // Add floating animation when in view
                if (Math.abs(distanceFromCenter) < windowHeight * 0.3) {
                    polaroid.classList.add('scroll-animate');
                } else {
                    polaroid.classList.remove('scroll-animate');
                }
            });
        }
        
        initManualMenuHighlighting() {
            const menuLinks = document.querySelectorAll('.menu-link');
            
            if (menuLinks.length === 0) {
                console.warn('No menu links found');
                return;
            }
            
            // Add click event listeners to each menu link
            menuLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // Remove active class from all links
                    menuLinks.forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link
                    link.classList.add('active');
                    
                    // Smooth scroll to section
                    const targetId = link.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        console.warn(`Target section ${targetId} not found`);
                    }
                });
            });
            
            // Set home as initially active
            const homeLink = document.querySelector('a[href="#home"]');
            if (homeLink) {
                homeLink.classList.add('active');
            } else {
                console.warn('Home link not found');
            }
        }
    }

    // Initialize the dynamic background system
    const dynamicBackground = new DynamicBackground();
    

</script>

</body>
</html>
